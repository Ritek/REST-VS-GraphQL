require('dotenv').config();
const fs = require('fs');
const express = require('express');
const { makeExecutableSchema } = require('@graphql-tools/schema');
const mongoose = require('mongoose');

var { graphqlHTTP } = require('express-graphql');
var { buildSchema } = require('graphql');

/* var schema = buildSchema( fs.readFileSync('./schema.graphql', 'utf-8') );

const root = require('./resolvers'); */
const typeDefs = require('./schema');
const resolvers = require('./graphql/resolvers')

const schema = makeExecutableSchema({
  typeDefs,
  resolvers,
});

var app = express();

app.use('/graphql', (req, res) => {
    return graphqlHTTP({
        schema: schema,
        rootValue: root,
        graphiql: true, // or whatever you want
        context: { req, res },
    }) (req, res);
});

mongoose.connect(process.env.MONGO_URI, {useNewUrlParser: true, useUnifiedTopology: true});
const db = mongoose.connection;
db.on('error', console.error.bind(console, 'connection error:'));
db.once('open', function() {
    app.listen(4000);
    console.log('Running a GraphQL API server at http://localhost:4000/graphql');
});